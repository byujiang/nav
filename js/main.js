function setHomePage(e){var t=document.URL.split("#")[0];try{e.style.behavior="url(#default#homepage)",e.setHomePage(t)}catch(e){if(window.netscape)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch).setCharPref("browser.startup.homepage",t)}catch(e){alert("抱歉，此操作被浏览器拒绝！\n\n您需要手动将【"+t+"】设置为首页。\n如果您不会设置主页，你可以去搜索“浏览器设置主页”")}else alert("抱歉，您所使用的浏览器无法完成此操作。\n\n您需要手动将【"+t+"】设置为首页。\n如果您不会设置主页，你可以去搜索“浏览器设置主页”")}try{window.external.AddFavorite(t,"次元壁导航")}catch(e){try{window.sidebar.addPanel("次元壁导航",t,"")}catch(e){}}}function set_foot_bottom(){$("html").innerHeight()<$(".container").outerHeight()+$("#foot").outerHeight()?$("#foot").removeClass("foot-bottom"):$("#foot").addClass("foot-bottom")}function set_search_type(e){$("#left-btn span").text($(e).text()),$("#left-btn img").attr("src",$(e).children("img").attr("src")),$("#search-input").attr("placeholder",null==$(e).data("tip")?"":$(e).data("tip")),$("#left-btn").attr("href",$(e).attr("href")),$("#search-btn").data("url",$(e).data("url")),$("#search-btn").data("newwindow",null!=$(e).data("newwindow")),$("#search-btn").data("end",null==$(e).data("end")?"":$(e).data("end")),$(e).data("uploadimage")?$("#img_upload_click").show():$("#img_upload_click").hide();var t=$(e).data("url2");return null!=t?$("#search-btn").data("url2",t):$("#search-btn").data("url2",""),!1}function getSearchData(e){for(var t="",a=0;a<e.s.length;a++)t+="<li><a href=\"javascript:$('#search-input').val('"+e.s[a]+"')\">"+e.s[a]+"</a></li>";$("#search-dropdown-list").html(t),""==t?$("#search-input").parent().removeClass("open"):$("#search-input").parent().addClass("open")}function setCookie(e,t,a){var i=new Date;i.setTime(i.getTime()+a),document.cookie=e+"="+escape(t)+";expires="+i.toGMTString()}function getCookie(e){var t,a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(a))?unescape(t[2]):null}function delCookie(e){var t=new Date;t.setTime(t.getTime()-1);var a=getCookie(e);null!=a&&(document.cookie=e+"="+a+";expires="+t.toGMTString())}function window_open(e){$("#newwindow").attr("href",e),document.getElementById("newwindow").click()}"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e}),$(function(){set_foot_bottom(),$(window).resize(function(){set_foot_bottom()}),document.getElementById("search-input").addEventListener("paste",function(e){if("none"!=$("#img_upload_click").css("display")&&e.clipboardData.files.length>0){if(-1===e.clipboardData.files[0].type.indexOf("image"))return!1;var t=new XMLHttpRequest;t.open("post","/ajax/UploadImage",!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.onloadend=function(e){var a=JSON.parse(t.responseText);"200"==a.code?($("#search-input").val(a.url),$("#search-btn").click()):alert(a.message)};var a=new FormData;a.append("file",e.clipboardData.files[0]),t.send(a)}}),$("#remove_link").modal("hide"),$(".box .remove_link").click(function(){return $("#remove_link").modal(),$("#remove_link_btn").data("id",$(this).data("id")),!1}),$("#remove_link_btn").click(function(){return $.post("/ajax/removelink",{id:$(this).data("id")},function(e){200==e.code?($("#remove_link").modal("hide"),window.location.reload()):$("#remove_link .alert").show().text(e.message)}),!1}),$("#edit_link").modal("hide"),$(".edit-link").click(function(){return $("#edit_link [name=name]").val($(this).data("name")),$("#edit_link [name=url]").val($(this).data("url")),$("#edit_link [name=id]").val($(this).data("id")),"False"==$(this).data("private")?$("#edit_link [name=private]").attr("checked","checked"):$("#edit_link [name=private]").removeAttr("checked"),$(this).hasClass("head_link")?($("#edit_link [type=checkbox]").attr("disabled","disabled"),$("#edit_link [type=checkbox]").attr("onclick","return false;"),$("#edit_link [type=checkbox]").attr("checked","checked")):($("#edit_link [type=checkbox]").removeAttr("disabled"),$("#edit_link [type=checkbox]").removeAttr("onclick")),$("#edit_link .alert").hide(),$("#edit_link").modal(),!1}),$("#edit_link_btn").click(function(){$.post("/ajax/EditLink",{name:$("#edit_link [name=name]").val(),url:$("#edit_link [name=url]").val(),Private:!$("#edit_link [name=private]").is(":checked"),id:$("#edit_link [name=id]").val()},function(e){200==e.code?($("#edit_link").modal("hide"),window.location.reload()):$("#edit_link .alert").show().text(e.message)})}),$("#edit_group").modal("hide"),$(".edit_group").click(function(){return $("#edit_group [name=name]").val($(this).data("name")),$("#edit_group [name=id]").val($(this).data("id")),"False"==$(this).data("private")?$("#edit_group [name=private]").attr("checked","checked"):$("#edit_group [name=private]").removeAttr("checked"),$("#edit_group").modal(),!1}),$("#edit_group_btn").click(function(){$.post("/ajax/Editgroup",{name:$("#edit_group [name=name]").val(),Private:!$("#edit_group [name=private]").is(":checked"),id:$("#edit_group [name=id]").val()},function(e){200==e.code?($("#edit_group").modal("hide"),window.location.reload()):$("#edit_group .alert").show().text(e.message)})}),$("#remove_group").modal("hide"),$(".remove_group").click(function(){return $("#remove_group").modal(),$("#remove_group_btn").data("id",$(this).data("id")),!1}),$("#remove_group_btn").click(function(){return $.post("/ajax/removegroup",{id:$(this).data("id")},function(e){200==e.code?($("#remove_group").modal("hide"),window.location.reload()):$("#remove_group .alert").show().text(e.message)}),!1}),$("#add_link").modal("hide"),$(".add_link").click(function(){return $("#add_link").modal(),$("#add_link .alert").hide(),$("#add_link_btn").data("id",$(this).data("id")),!1}),$("#add_link_btn").click(function(){return $.post("/ajax/addLink",{name:$("#add_link [name=name]").val(),url:$("#add_link [name=url]").val(),Private:!$("#add_link [name=private]").is(":checked"),id:$("#add_link_btn").data("id")},function(e){200==e.code?($("#add_link").modal("hide"),window.location.reload()):$("#add_link .alert").show().text(e.message)}),!1}),$("#quick_add_link_btn").click(function(){return $.post("/ajax/addLink",{name:$("#quick_add_link [name=name]").val(),url:$("#quick_add_link [name=url]").val(),Private:!$("#quick_add_link [name=private]").is(":checked"),id:$("#quick_add_link select").val()},function(e){200==e.code?($("#quick_add_link").modal("hide"),window.location="/"+e.linkname):$("#quick_add_link .alert").show().text(e.message)}),!1}),$("#add_group").modal("hide"),$(".add_group").click(function(){return $("#add_group").modal(),!1}),$("#add_group_btn").click(function(){return $.post("/ajax/addgroup",{name:$("#add_group [name=name]").val(),Private:!$("#add_group [name=private]").is(":checked")},function(e){200==e.code?($("#add_group").modal("hide"),window.location.reload()):$("#add_group .alert").show().text(e.message)}),!1}),$(".square .glyphicon-pencil").click(function(){return!1}),$("#login_register").modal("hide"),$(".nav-input a").click(function(){for(var e=$(".nav-input img"),t=0;t<e.length;t++)""==e.eq(t).attr("src")&&e.eq(t).attr("src",e.eq(t).data("src"));return $(".nav-input a").removeClass("active"),$(this).addClass("active"),$("#dropdown-list").html($(this).next("ul").html()),set_search_type($("#dropdown-list a")[0]),!1}),$("#search-input").keydown(function(e){if(13==e.keyCode)$("#search-btn").click();else{var t=$("#search-dropdown-list a");if(38==e.keyCode){if(0==$("#search-dropdown-list .select").length&&t.length>0)t.eq(t.length-1).addClass("select");else if(t.length>0&&1==$("#search-dropdown-list .select").length){for(var a=-1,i=0;i<t.length;i++)if(t.eq(i).hasClass("select")){a=i;break}(a-=1)>=0&&($("#search-dropdown-list .select").removeClass("select"),t.eq(a).addClass("select"))}$("#search-input").val($("#search-dropdown-list .select").text())}else if(40==e.keyCode){if(0==$("#search-dropdown-list .select").length&&t.length>0)t.eq(0).addClass("select");else if(t.length>0&&1==$("#search-dropdown-list .select").length){for(a=-1,i=0;i<t.length;i++)if(t.eq(i).hasClass("select")){a=i;break}(a+=1)<t.length&&($("#search-dropdown-list .select").removeClass("select"),t.eq(a).addClass("select"))}$("#search-input").val($("#search-dropdown-list .select").text())}}}),$("#search-input").blur(function(){setTimeout(function(){$("#search-input").parent().removeClass("open")},200)}),$("#search-input").keyup(function(e){13!=e.keyCode&&38!=e.keyCode&&40!=e.keyCode&&$.ajax({type:"get",async:!1,url:"https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?wd="+encodeURIComponent($("#search-input").val()),dataType:"jsonp",jsonp:"cb",jsonpCallback:"getSearchData",success:function(e){},error:function(){}})}),$("#search-btn").click(function(){var e=$("#search-input").val(),t="";(e.toLowerCase().startsWith("http://")||e.toLowerCase().startsWith("https://"))&&""!=$("#search-btn").data("url2")?t=$("#search-btn").data("url2")+encodeURIComponent(e):(t=$("#search-btn").data("url")+encodeURIComponent(e),""!=$(this).data("end")&&(t+=$(this).data("end")));for(var a=0,i=$(".nav-input>li>a"),n=0;n<i.length;n++)if(i.eq(n).hasClass("active")){a=n;break}"blank"==$(this).data("target")?!$(this).data("toolbar")||$(this).data("newwindow")||$(this).data("mobile")?window_open(t):window_open("/search?url="+encodeURIComponent(t)+"&keyword="+encodeURIComponent(Base.encode(e))+"&index="+a):!$(this).data("toolbar")||$(this).data("newwindow")||$(this).data("mobile")?window.location=t:top.location="/search?url="+encodeURIComponent(t)+"&keyword="+encodeURIComponent(Base.encode(e))+"&index="+a}),$("#edit_mode").click(function(){if("编辑"==$("#edit_mode").text()){if(""==$("#user_name").text())return $("#login_register").modal(),!1;0==$("#setting").length?window.location="/":($(".edit_mode").show(),$("#edit_mode").text("取消编辑"),setCookie("editmode","true",6e4))}else $(".edit_mode").hide(),$("#edit_mode").text("编辑"),delCookie("editmode");return!1}),"true"==getCookie("editmode")&&($(".edit_mode").show(),$("#edit_mode").text("取消编辑")),$("#setting").modal("hide"),$("#setting_click").click(function(){if(""==$("#user_name").text())return $("#login_register").modal(),!1;if(0==$("#setting").length)window.location="/";else{$("#setting").modal();for(var e=$("#setting img"),t=0;t<e.length;t++)""==e.eq(t).attr("src")&&e.eq(t).attr("src",e.eq(t).data("src"))}return!1}),$("#setting_btn").click(function(){var e=$("#setting [name=backimage]").val();""!=$("#setting [name=backimageurl]").val()&&(e=$("#setting [name=backimageurl]").val()),$.post("/ajax/SaveSetting",{linkName:$("#setting [name=name]").val(),title:$("#setting [name=title]").val(),backimage:e,newwindow:$("#setting [name=newwindow]").is(":checked"),toolbar:$("#setting [name=toolbar]").is(":checked")},function(e){200==e.code?($("#setting").modal("hide"),window.location="/"+e.linkname):$("#setting .alert-danger").show().text(e.message)})}),$("#setting img").click(function(){$("#setting img").removeClass("image_select"),$(this).addClass("image_select"),$("#setting [name=backimage]").val($(this).data("url"))}),$("#login_register_btn").click(function(){return $("#login_register .alert").hide(),"登录"==$("#login_register .nav-tabs .active").text()?$.post("/ajax/login",{email:$("#login_name").val(),password:$("#login_password").val(),remember:"true",linkName:$(this).data("link")},function(e){200==e.code?($("#login_register_click").hide(),$("#user_name").text(e.username),$("#logout_btn").show(),$("#login_register").modal("hide"),e.refresh&&window.location.reload()):null!=e.message?$("#login_register .alert").show().text(e.message):$("#login_register .alert").show().text("登录失败")}):$.post("/ajax/Register",{email:$("#register_email").val(),password:$("#register_password").val(),code:$("#register_code").val(),username:$("#register_name").val()},function(e){200==e.code?(alert("注册成功！请登录一下"),$("#login_register").modal("hide"),window.location.reload()):null!=e.message?$("#login_register .alert").show().text(e.message):$("#login_register .alert").show().text("注册失败")}),!1}),$("#logout_btn").click(function(){$.get("/ajax/logout"),$("#login_register_click").show(),$("#user_name").text(""),$("#logout_btn").hide()}),$("#login_register_click").click(function(){var e=$("#register img");""==e.attr("src")&&e.attr("src",e.data("src"))}),$("#img_upload_click").click(function(){document.getElementById("file_upload").click()}),$("#file_upload").change(function(){if(""!=$(this).val()){var e=new FormData;e.append("file",document.getElementById("file_upload").files[0]),$.ajax({url:"/ajax/UploadImage",type:"POST",data:e,contentType:!1,processData:!1,success:function(e){"200"==e.code?($("#search-input").val(e.url),$("#search-btn").click()):alert(e.message)},error:function(){alert("上传失败！")}})}})});